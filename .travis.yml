language: java
cache:
  directories:
  - "$HOME/.m2"
  - frontend/node
  - frontend/node_modules
jdk: oraclejdk8
install: "/bin/true" # workaround https://github.com/Swagger2Markup/swagger2markup-maven-plugin/pull/24
# https://docs.travis-ci.com/user/gui-and-headless-browsers/
before_script:
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3 # give xvfb some time to start
  - (cd docker; docker-compose up -d)
after_acript:
  - "sh -e /etc/init.d/xvfb stop"
  - (cd docker; docker-compose down)
after_success:
  - if [ "$TRAVIS_BRANCH" == "master" ]; then (
      cd docker;
      docker login -u="$DOCKER_LOGIN" -p="$DOCKER_PASSWORD";
      docker-compose -f docker-compose.yml -f docker-compose.dev.yml build
      docker push nikit007/blog:latest;
    ) fi
script:
  # if there isn't pointed explicitly PhantomJS will be used by default for both webdriver integration test and js unit test
  - "./mvnw -P frontend clean package"
  - "./mvnw -Dkarma.browsers=Firefox -Dcustom.selenium.browser=FIREFOX -P frontend clean package"
  - "./mvnw -Dkarma.browsers=Chrome -Dcustom.selenium.browser=CHROME -P frontend clean package"
addons:
  firefox: "56.0"
  chrome: stable